<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tokamachi</title>
<script>
var data = [
    [565,21.7],//1981年の1月の積雪量と1980年の7月の平均気温
    [315,22.6],//1981年の2月の積雪量と1980年の8月の平均気温
    [137,19.1],//1981年の3月の積雪量と1980年の9月の平均気温
    [323,24.6],//1982年の1月の積雪量と1981年の7月の平均気温
    [311,23.7],
    [161,18.5],
    [412,22.2],
    [392,24.5],
    [163,19],
    [527,22.2],
    [416,25.4],
    [284,20.9],
    [545,24.6],
    [276,26],
    [174,19.8],
    [659,23.5],
    [541,27.4],
    [232,20],
    [660,21.8],
    [488,25],
    [410,20.6],
    [467,24.3],
    [481,24.6],
    [250,20.7],
    [262,21.9],
    [310,25.1],
    [69,20.4],
    [582,23.2],
    [142,24.5],
    [92,20.4],
    [471,24.2],
    [358,25.7],
    [119,21.2],
    [311,23.2],
    [325,23.5],
    [117,20.9],
    [308,22.9],
    [394,24.9],
    [184,19.5],
    [433,21.8],
    [317,22.1],
    [186,19],
    [485,25.5],
    [279,27],
    [132,21.5],
    [389,23.2],
    [324,25.1],
    [217,18.5],
    [374,23.7],
    [228,24.2],
    [104,19],
    [447,23.6],
    [205,24.5],
    [137,19.4],
    [379,24.1],
    [358,23.8],
    [129,21.9],
    [234,23.8],
    [390,26.2],
    [243,22.6],
    [472,24.7],
    [263,26],
    [208,21.5],
    [370,25.3],
    [219,24.6],
    [111,20],
    [340,25],
    [190,25.2],
    [189,20.1],
    [314,21.4],
    [287,23.8],
    [146,20.7],
    [560,25.2],
    [345,24.2],
    [228,21.9],
    [379,23.2],
    [233,25.1],
    [239,21.7],
    [153,22.5],
    [139,26.1],
    [183,20.2],
    [346,21.8],
    [335,25.4],
    [151,22.9],
    [198,24.5],
    [186,24.3],
    [109,20.4],
    [464,22.7],
    [205,23.5],
    [95,19.7],
    [558,24.4],
    [92,26.7],
    [270,21.3],
    [484,24.7],
    [306,24.9],6358
    [143,21.3],
    [359,24.2],
    [321,26.1],
    [70,22.6],
    [310,23.8],
    [222,24.8],
    [154,20.6],
    [292,23.4],
    [228,24],
    [115,19.2],
    [217,24.1],
    [223,24.3],
    [62,18.9],
    [308,23.7],
    [271,24.8],
    [76,21.4],
    [331,24.4],
    [289,24.4],
    [33,19.5],
    [313,26.3],
    [147,24.9],
    [57,19.9],
    [32,23.8],
    [202,25.9],
    [19,21.6],
    [397,22.3],
    [275,26.1],
    [26,22.2],
    [313,24.7],
    [307,25.1],
    [54,20.8],
    [290,25.3],
    [162,25.1],
    [30,22.1]
]
function draw(data, value) {
    var canvas = document.getElementById('tutorial');
    if (canvas.getContext) {
        var ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, 470, 345);
        ctx.lineWidth = 1;
        ctx.strokeStyle = 'rgb(0, 0, 0)';
        ctx.beginPath();
        ctx.moveTo(35, 25);
        ctx.lineTo(35, 245);
        ctx.lineTo(335, 245);
        ctx.stroke();
        ctx.globalAlpha = 1;
        ctx.beginPath();
        ctx.fillText('月平均気温(℃)', 5, 20);
        ctx.fillText('合計積雪量', 290, 265);
        ctx.fillText('(cm)', 325, 275);
        ctx.fillText('0', 33, 255);
        ctx.fillText('17', 21, 245);
        ctx.fillText(value + '年度', 10, 270);
        ctx.fillText('8月の平均気温 ' + data[(value - 1980) * 3 + 1][1] + '℃', 58, 270);
        ctx.fillText('1月の積雪量合計 ' + data[(value - 1980) * 3][0] + 'cm', 58, 283);
        ctx.fillText('十日町の同年度の平均気温と積雪量合計', 90, 15);
        ctx.fillText('データ出典:気象庁オープンデータ', 190, 285);
        ctx.fillText('下のスライダーを動かすと年度が変わります。', 10, 295);

        for (var i = 0; i < 6; i++){
            ctx.beginPath();
            ctx.moveTo(85 + i * 50, 25);
            ctx.lineTo(85 + i * 50, 245);
            ctx.stroke();
        }
        for (var i = 0; i < 12; i++){
            ctx.beginPath();
            ctx.moveTo(35, 245 - i * 20);
            ctx.lineTo(335, 245 - i * 20);
            ctx.stroke();
        }
        for (var i = 1; i < 12; i++){
            ctx.fillText(17 + i, 21, 245 - i * 19.5);
        }
        for (var i = 1; i < 7; i++){
            ctx.fillText(100 * i, 25 + i * 50, 255);
        }
        var kiontotal = 0;
        var sekisetutotal = 0;
        for (var i = 0; i < 127; i = i + 3) {
            ctx.globalAlpha = 0.4;
            ctx.strokeStyle = 'rgb(0, 0, 0)';
            if (value == i / 3 + 1980) {
                ctx.strokeStyle = 'rgb(255, 0, 0)';
                ctx.globalAlpha = 1;
            }
            var kion = data[i + 1][1] - 17;// + data[i + 1][1] + data[i + 2][1];
            //var kion = kion / 3 - 17;
            var sekisetu = data[i][0];// + data[i + 1][0] + data[i + 2][0];
            //var sekisetu = sekisetu / 3;
            ctx.beginPath();
            ctx.arc(sekisetu / 2 + 35, 245 - kion * 20, 2, 0, Math.PI * 2, true);
            ctx.stroke();
            kiontotal = kiontotal + data[i + 1][1];
            sekisetutotal = sekisetutotal + data[i][0];
        }
        ctx.globalAlpha = 1;
        var kionheikin = kiontotal / 43;
        var sekisetuheikin = sekisetutotal / 43;
        var sx = 0;
        var sy = 0;
        var sxtotal = 0;
        var sytotal = 0;
        var kyobunsantotal = 0;
        for (var i = 0; i < 127; i = i + 3){
            sx = (kionheikin - data[i + 1][1]) ** 2;
            sy = (sekisetuheikin - data[i][0]) ** 2;
            sxtotal = sxtotal + sx;
            sytotal = sytotal + sy;
            kyobunsantotal = kyobunsantotal + (kionheikin - data[i + 1][1]) * (sekisetuheikin - data[i][0])
        }
        var kyobunsan = kyobunsantotal / 43;
        var sxrt = Math.sqrt(sxtotal / 43);
        var syrt = Math.sqrt(sytotal / 43);
        var soukankeisu = kyobunsan / (sxrt * syrt);
        ctx.fillText('相関係数 = ' + soukankeisu, 150, 220);
    }
}
function inputChange(value){
    draw(data, value)
}



</script>
</head>
<style>
    /*境界線を1pxの黒の実線で塗る*/
    canvas { border: 1px solid black; }
    input[type="range"] {
      width: 350px;
      margin: 0;
    }
</style>
<body onload="draw(data, 1980);">
<canvas id="tutorial" width="350" height="300"></canvas><br>
<input type="range" min="1980" max="2022" step="1" id="slider" value="1980" onchange="inputChange(this.value)">
</body>
</html>
